"use strict";(self.webpackChunkmultichain_poc=self.webpackChunkmultichain_poc||[]).push([[196],{9312:(e,t,n)=>{n.d(t,{c:()=>c});var r=n(7126);function s(e,t){switch(e.binary){case"bytes":if("layout"in e){const{custom:n}=e;return void 0===n||"function"!=typeof n.from?o(e.layout,n?n.from:t):t}case"int":case"uint":{const{custom:n}=e;return null!=e&&e.omit?void 0:(0,r.cX)(n)?n:(0,r.cY)(n)?n.to:t}case"array":return Array.isArray(t)?t.map((t=>o(e.layout,t))):void 0;case"switch":{const n=t[e.idTag??"id"],[r,s]=e.layouts.find((e=>{let[t]=e;return(Array.isArray(t)?t[1]:t)==n}));return{[e.idTag??"id"]:n,...o(s,t)}}}}function o(e,t){if(t=t??{},(0,r.cW)(e))return s(e,t);const n={};for(const r of e){const e=s(r,t[r.name]??{});void 0!==e&&(n[r.name]=e)}return n}function a(e,t){return o(e,t)}function i(e){return[...r.c_,(0,r.c$)(e)]}function c(e,t){const[n,s]=(0,r.cZ)(e),o=a(i(e),t);return{protocolName:n,payloadName:s,payloadLiteral:e,...a(r.d0,t),...o,hash:(0,r.cF)((0,r.cT)(i(e),o))}}},196:(e,t,n)=>{n.r(t),n.d(t,{A:()=>m,S:()=>g,a:()=>d,i:()=>A});var r=n(7126),s=n(2763),o=n(9312),a=n(6310),i=Object.defineProperty,c=(e,t,n)=>(((e,t,n)=>{t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);class d{constructor(e,t,n,r){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];c(this,"transaction"),c(this,"network"),c(this,"chain"),c(this,"description"),c(this,"parallelizable"),this.transaction=e,this.network=t,this.chain=n,this.description=r,this.parallelizable=s}}const u=1002e3,p=1016,h=15240,l={_limit:127,encodingLength:e=>{let t=0;for(;e>=128;t++)e>>=7;return t+1},encode:(e,t,n)=>{if("bigint"==typeof e&&(e=(0,s.s)(e)),e<0)throw new RangeError("value must be unsigned");const r=l.encodingLength(e);if(n=n||0,(t=t||new ArrayBuffer(r)).byteLength<n+r)throw new RangeError("the buffer is too small to encode the number at the offset");const o=new Uint8Array(t,n);let a=0;for(;l._limit<e;)o[a++]=e&l._limit|128,e>>=7;return o[a]=Number(e),o},decode:function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,s=0;do{if(t=e[n+s],void 0===t)throw new RangeError("offset out of range");r+=(t&l._limit)<<7*s,s++}while(128<=t);return r}},g={forMessageId:(e,t)=>{const n=(0,r.cb)((0,r.d1)(e)).publicKey,s=t.emitter.toUniversalAddress().toUint8Array(),o=r.aA.toBytes(BigInt((0,r.bW)(t.chain)),2),a=r.b3.concat(o,s);return g.fromData({appId:e,appAddress:n,idx:t.sequence/BigInt(h),address:a})},forWrappedAsset:(e,t)=>{if((0,r.ax)(t.address))throw new Error("native asset cannot be a wrapped asset");const n=(0,r.cb)((0,r.d1)(e)).publicKey;return g.fromData({appId:e,appAddress:n,idx:BigInt((0,r.bW)(t.chain)),address:t.address.toUniversalAddress().toUint8Array()})},forNativeAsset:(e,t)=>{const n=(0,r.cb)((0,r.d1)(e)).publicKey;return g.fromData({appId:e,appAddress:n,idx:t,address:r.b3.encode("native")})},forGuardianSet:(e,t)=>{const n=(0,r.cb)((0,r.d1)(e)).publicKey;return g.fromData({appId:e,appAddress:n,idx:BigInt(t),address:r.b3.encode("guardian")})},forEmitter:(e,t)=>{const n=(0,r.cb)((0,r.d1)(e)).publicKey;return g.fromData({appId:e,appAddress:n,idx:0n,address:t})},_encode:e=>"bigint"==typeof e?[r.ar.encode(l.encode(e))]:[r.ar.encode(l.encode(e.length)),r.ar.encode(e)],fromData:e=>{const t=["0620010181",...g._encode(e.idx),"4880",...g._encode(e.address),"483110810612443119221244311881",...g._encode(e.appId),"1244312080",...g._encode(e.appAddress),"124431018100124431093203124431153203124422"],n=r.ar.decode(t.join(""));return new r.d2(n)},decodeLocalState:async(e,t,n)=>{let o;try{const a=await e.accountApplicationInformation(n,(0,s.s)(t)).do();o=r.d3.from_obj_for_encoding(a).appLocalState}catch{return new Uint8Array}const a=r.b2.encode("meta");let i=new Map;for(const s of o.keyValue){if(s.key===a)continue;const e=r.b2.decode(s.key)[0],t=r.b2.decode(s.value.bytes);i.set(e,t)}const c=[];for(let r=0;r<15;r++)i.has(r)&&c.push(i.get(r));return r.b3.concat(...c)},checkBitsSet:async(e,t,n,o)=>{let a,i=!1;const c=await e.accountInformation(n).do(),d=r.d4.from_obj_for_encoding(c).appsLocalState;if(d&&d.forEach((e=>{BigInt(e.id)===t&&(a=e.keyValue)})),0===(null==a?void 0:a.length))return i;const u=BigInt(h),l=BigInt(8),g=o/u*u,f=(0,s.s)(o-g),m=Math.floor(f/p),A=Math.floor((f-m*p)/8),y=r.b2.encode(r.aA.toBytes(m,1));return null==a||a.forEach((e=>{if(e.key!==y);else{const t=r.d.Buffer.from(e.value.bytes,"base64"),n=1<<(0,s.s)(o%l);i=0!=(t[A]&n)}})),i},storageAccountExists:async(e,t,n)=>{try{const r=await e.accountApplicationInformation(t,(0,s.s)(n)).do();return Object.keys(r).length>0}catch{}return!1}},f=class e{constructor(e,t,n,s){if(c(this,"network"),c(this,"chain"),c(this,"connection"),c(this,"contracts"),c(this,"chainId"),c(this,"coreAppId"),c(this,"coreAppAddress"),c(this,"tokenBridgeAppId"),c(this,"tokenBridgeAppAddress"),this.network=e,this.chain=t,this.connection=n,this.contracts=s,this.chainId=(0,r.bW)(t),!s.coreBridge)throw new Error(`Core contract address for chain ${t} not found`);const o=BigInt(s.coreBridge);if(this.coreAppId=o,this.coreAppAddress=(0,r.d1)(o),!s.tokenBridge)throw new Error(`TokenBridge contract address for chain ${t} not found`);const a=BigInt(s.tokenBridge);this.tokenBridgeAppId=a,this.tokenBridgeAppAddress=(0,r.d1)(a)}getGuardianSet(e){throw new Error("Method not implemented.")}async*verifyMessage(t,n,r){const o=new s.A(t).toString(),a=await e.submitVAAHeader(this.connection,this.coreAppId,r??this.coreAppId,n,o);for(const e of a.txs)yield this.createUnsignedTx(e,"Core.verifyMessage")}static async fromRpc(t,n){const[r,o]=await s.a.chainFromRpc(t),a=n[o];if(a.network!==r)throw new Error(`Network mismatch: ${a.network} !== ${r}`);return new e(r,o,t,a.contracts)}async*publishMessage(t,n){const o=new s.A(t),a=o.toString(),i=await this.connection.getTransactionParams().do(),c=g.forEmitter(this.coreAppId,o.toUint8Array()),{accounts:d,txs:u}=await e.maybeCreateStorageTx(this.connection,a,this.coreAppId,c,i);for(const e of u)yield this.createUnsignedTx(e,"Core.publishMessage",!0);const p=(0,r.d5)({from:a,appIndex:(0,s.s)(this.coreAppId),appArgs:[e.publishMessage,n,r.aA.toBytes(0n,8)],accounts:d,onComplete:r.d6.NoOpOC,suggestedParams:i});yield this.createUnsignedTx({tx:p},"Core.publishMessage",!0)}async getMessageFee(){var t;const n=await this.connection.getApplicationByID((0,s.s)(this.coreAppId)).do(),o=null==(t=r.d7.from_obj_for_encoding(n).params.globalState)?void 0:t.find((t=>t.key===e.feeKey));return o?BigInt(o.value.uint):0n}async getGuardianSetIndex(){throw new Error("Not implemented")}async parseTransaction(e){const t=await this.connection.pendingTransactionInformation(e).do(),n=r.d8.from_obj_for_encoding(t);return this.parseTx(n).map((e=>({chain:e.emitterChain,emitter:e.emitterAddress,sequence:e.sequence})))}async parseMessages(e){const t=await this.connection.pendingTransactionInformation(e).do(),n=r.d8.from_obj_for_encoding(t);return this.parseTx(n)}parseTx(t){const n=[];if(t.innerTxns&&t.innerTxns.length>0&&n.push(...t.innerTxns.flatMap((e=>this.parseTx(e)))),BigInt(t.txn.txn.apid??0)!==this.coreAppId||!t.logs||0===t.logs.length)return n;const a=t.txn.txn.apaa??[];if(3!==a.length||!r.b3.equals(new Uint8Array(a[0]),e.publishMessage))return n;const i=r.aA.decode(t.logs[0]),c=new s.A(t.txn.txn.snd).toUniversalAddress(),d=new Uint8Array(a[1]),u=r.aA.decode(a[2]);return n.push((0,o.c)("Uint8Array",{emitterChain:this.chain,emitterAddress:c,sequence:i,guardianSet:0,timestamp:0,consistencyLevel:0,nonce:Number(u),payload:d,signatures:[]})),n}static async maybeCreateStorageTx(e,t,n,o,a){const i=(0,r.d1)(n),c=o.address(),d=[];if(await g.storageAccountExists(e,c,n))return{accounts:[c],txs:d};a=a??await e.getTransactionParams().do();const p=(0,r.d9)({from:t,to:c,amount:u,suggestedParams:a});p.fee=2*p.fee,d.push({tx:p});const h=(0,r.da)({from:c,appIndex:(0,s.s)(n),rekeyTo:i,suggestedParams:a});return h.fee=0,d.push({tx:h,signer:{address:o.address(),signTxn:e=>Promise.resolve((0,r.db)(e,o).blob)}}),{accounts:[c],txs:d}}static async submitVAAHeader(t,n,o,a,i,c){c=c??await t.getTransactionParams().do();let d=[];const u=g.forMessageId(o,{chain:a.emitterChain,sequence:a.sequence,emitter:a.emitterAddress}),{accounts:p,txs:h}=await e.maybeCreateStorageTx(t,i,o,u,c);d.push(...h);const l=g.forGuardianSet(n,a.guardianSet),{accounts:[f],txs:m}=await e.maybeCreateStorageTx(t,i,n,l,c);d.push(...m);let A=[...p,f];const y=await g.decodeLocalState(t,n,f),b=(0,r.cF)(a.hash),w=a.signatures.length,I=Math.ceil(w/e.MAX_SIGS_PER_TXN),_=new r.d2(e.ALGO_VERIFY);for(let g=0;g<I;g++){const t=g*e.MAX_SIGS_PER_TXN,o=a.signatures.slice(t,t+e.MAX_SIGS_PER_TXN),i=20*o.length,u=new Uint8Array(i);for(let e=0;e<o.length;e++){const t=o[e],n=y.slice(20*t.guardianIndex+1,20*(t.guardianIndex+1)+1);u.set(n,20*e)}const p=(0,r.d5)({appArgs:[e.verifySigs,r.b3.concat(...o.map((e=>r.b3.concat(new Uint8Array([e.guardianIndex]),e.signature.encode())))),u,b],accounts:A,appIndex:(0,s.s)(n),from:e.ALGO_VERIFY_HASH,onComplete:r.d6.NoOpOC,suggestedParams:c});p.fee=0,d.push({tx:p,signer:{address:_.address(),signTxn:e=>Promise.resolve((0,r.db)(e,_).blob)}})}const x=(0,r.d5)({appArgs:[e.verifyVaa,(0,r.cw)(a)],accounts:A,appIndex:(0,s.s)(n),from:i,onComplete:r.d6.NoOpOC,suggestedParams:c});return x.fee=x.fee*(2+I),d.push({tx:x}),{accounts:A,txs:d}}createUnsignedTx(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new d(e,this.network,this.chain,t,n)}};c(f,"MAX_SIGS_PER_TXN",6),c(f,"ALGO_VERIFY_HASH","EZATROXX2HISIRZDRGXW4LRQ46Z6IUJYYIHU3PJGP7P5IQDPKVX42N767A"),c(f,"ALGO_VERIFY",new Uint8Array([6,32,4,1,0,32,20,38,1,0,49,32,50,3,18,68,49,1,35,18,68,49,16,129,6,18,68,54,26,1,54,26,3,54,26,2,136,0,3,68,34,67,53,2,53,1,53,0,40,53,240,40,53,241,52,0,21,53,5,35,53,3,35,53,4,52,3,52,5,12,65,0,68,52,1,52,0,52,3,129,65,8,34,88,23,52,0,52,3,34,8,36,88,52,0,52,3,129,33,8,36,88,7,0,53,241,53,240,52,2,52,4,37,88,52,240,52,241,80,2,87,12,20,18,68,52,3,129,66,8,53,3,52,4,37,8,53,4,66,255,180,34,137])),c(f,"feeKey",r.b2.encode("MessageFee")),c(f,"verifyVaa",r.b3.encode("verifyVAA")),c(f,"verifySigs",r.b3.encode("verifySigs")),c(f,"publishMessage",r.b3.encode("publishMessage"));let m=f;(0,a.r)("Algorand","WormholeCore",m);const A=Object.freeze(Object.defineProperty({__proto__:null,AlgorandWormholeCore:m,BITS_PER_BYTE:8,BITS_PER_KEY:p,MAX_BITS:h,MAX_BYTES:1905,MAX_BYTES_PER_KEY:127,MAX_KEYS:15,SEED_AMT:u,StorageLogicSig:g,varint:l},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=196.079fa10d.chunk.js.map